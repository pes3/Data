WITH ukSellerTrans AS
(
SELECT SELLER_ID,
TRANSACTION_DATE,
QUANTITY,
AMOUNT
FROM TRANSACTIONS
WHERE SELLER_ID IN (SELECT SELLER_ID FROM SELLER WHERE COUNTRY = 'UK')
AND TRANSACTION_DATE BETWEEN '12/06/2015' AND '12/20/2015'
)
SELECT t1.SELLER_ID,
t1.TOTAL_TRANS_AMT AS "WEEK_1_TRANS_TOTAL",
t2.TOTAL_TRANS_AMT AS "WEEK_2_TRANS_TOTAL"
FROM
(
SELECT SELLER_ID,
SUM(QUANTITY*PRICE) AS "TOTAL_TRANS_AMT"
FROM ukSellerTrans
WHERE TRANSACTION_DATE <= '12/12/2015'
GROUP BY SELLER_ID
) t1
INNER JOIN
(
SELECT SELLER_ID,
SUM(QUANTITY*PRICE) AS "TOTAL_TRANS_AMT"
FROM ukSellerTrans
WHERE TRANSACTION_DATE >= '12/13/2015'
GROUP BY SELLER_ID
) t2
ON t1.SELLER_ID = t2.SELLER_ID
WHERE t2.TOTAL_TRANS_AMT >= (t1.TOTAL_TRANS_AMT*2);
